matrix:
  TOOLCHAIN:
    - ubuntu:16.04 gcc-5 g++-5 libopenblas-dev fftw3-dev
    - ubuntu:18.04 gcc-8 g++-8 libopenblas-dev fftw3-dev
    - ubuntu:22.04 gcc-9 g++-9 libopenblas-dev fftw3-dev
    - ubuntu:22.04 gcc-11 g++-11 libopenblas-dev fftw3-dev
    - almalinux:8.7 gcc gcc-c++:g++ gcc-gfortran blas-devel lapack-devel fftw-devel
    - opensuse/leap:15.4 gcc10:gcc-10 gcc10-c++:g++-10 blas-devel lapack-devel fftw3-devel

pipeline:
  build_minimal:
    image: ${TOOLCHAIN%% *}
    environment:
      - VERBOSE=1
    commands:
      - ./utils/install_pkgs.sh && . ./.env
      - cd ./bin/ && make --trace
      - ldd ./slabcc
      - ./slabcc -v

when:
  path:
    include: [ 'bin/*', 'src/**', '.woodpecker/.build_slabcc.yml', 'utils/install_pkgs.sh' ]

depends_on:
  - validate